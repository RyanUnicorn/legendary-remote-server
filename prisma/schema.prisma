// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Admin {
  password String @id @default("12345678")
}

model Board {
  id   String @id
  name String

  devices Device[]
}

// device in HomeAssistant
model Device {
  // board - relation = device
  board   Board?  @relation(fields: [boardId], references: [id], onUpdate: SetNull, onDelete: Cascade)
  boardId String?

  id               Int     @id @default(autoincrement())
  name             String
  enableUpdate     Boolean @default(true)
  blocklyJS        String?
  blocklyWorkspace String?

  entities Entity[]
  irCodes  IrCode[]
}

model IrCode {
  device   Device? @relation(fields: [deviceId], references: [id], onUpdate: SetNull, onDelete: Cascade)
  deviceId Int?

  id          Int     @id @default(autoincrement())
  name        String
  description String?
  rawData     String
}

// entity in HomeAssistant
model Entity {
  // device - relation = entity
  device   Device? @relation(fields: [deviceId], references: [id], onDelete: Cascade)
  deviceId Int?

  id   Int     @id @default(autoincrement())
  name String
  icon String?

  type   String // one of the subtypes: switch, select, button, number
  // subtypes
  switch Switch?
  select Select?
  button Button?
  number Number?
}

model Switch {
  entity   Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  entityId Int    @id

  state Boolean
}

model Select {
  entity   Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  entityId Int    @id

  // !!primitive type can't be array!!
  options String
  state   String?
}

model Button {
  entity   Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  entityId Int    @id
}

model Number {
  entity   Entity @relation(fields: [entityId], references: [id], onDelete: Cascade)
  entityId Int    @id

  state    Float
  max      Float    @default(100)
  min      Float    @default(1)
  step     Float    @default(1)
  isSlider Boolean?
}

// model ac {}
// model fan {}
// model light {}
