import{z as $,e as P,r as c,A as L,f as W,o as i,c as n,i as u,j as N,b as s,w as _,T as f,F as D,k as w,l as h}from"./index-35bf6fef.js";import{_ as I,B as d,j as y}from"./index-a69bcb5c.js";import{a as g}from"./axios-28bc18a3.js";const J={class:"blocklyArea"},R={key:0,class:"successPopUp"},A=s("svg",{xmlns:"http://www.w3.org/2000/svg",height:"10em",viewBox:"0 0 448 512"},[s("path",{d:"M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"})],-1),E=[A],F={key:0,class:"failPopUp"},M=s("svg",{xmlns:"http://www.w3.org/2000/svg",height:"10em",width:"10em",viewBox:"0 0 384 512"},[s("path",{d:"M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"})],-1),O=[M],K={__name:"BlocklyView",setup(G){const m=$(),b=P(),t=m.params.id,p=c([]),v=c(null),o=L(),l=c(!1),r=c(!1);var x="Default-toolbox";async function B(){try{const e=await g.get(`${w.$origin}/api/devices/${t}`);p.value=e.data}catch(e){console.error(e)}}const C=()=>{o.value=d.inject(v.value,{toolbox:document.getElementById(x)});const e=o.value.getParentSvg();e&&(e.style.backgroundColor="var(--color-background)",e.style.borderRadius="var(--border-radius)"),o.value?o.value.addChangeListener(j):console.error("Workspace is not initialized properly.")};function S(){const e=p.value.blocklyWorkspace,a=JSON.parse(e);d.serialization.workspaces.load(a,o.value)}const j=()=>{if(o.value){const e=y.javascriptGenerator.workspaceToCode(o.value);console.log(e)}else console.error("Workspace is not initialized properly.")};async function z(){const e=y.javascriptGenerator.workspaceToCode(o.value),a=JSON.stringify(d.serialization.workspaces.save(o.value));try{await g.put(`${w.$origin}/api/devices/${t}`,{blocklyJS:e,blocklyWorkspace:a}),console.log(a),k(!0)}catch(V){k(!1),console.log(V)}}function T(){b.push(`/devices/${t}`)}function k(e){e?(l.value=!0,setTimeout(()=>{l.value=!1},1e3)):(r.value=!0,setTimeout(()=>{r.value=!1},1e3))}return W(async()=>{await B(),await new Promise(e=>setTimeout(e,250)),C(),S()}),(e,a)=>(i(),n(D,null,[u(I,{deviceId:N(t)},null,8,["deviceId"]),s("div",J,[s("div",{ref_key:"blocklyDiv",ref:v,class:"neu-box",style:{height:"100%",width:"100%"}},null,512),s("div",{onClick:T,class:"back-btn"},"< Back"),s("div",{onClick:z,class:"neu-box save-btn"},"Save"),u(f,{name:"fade"},{default:_(()=>[l.value?(i(),n("div",R,E)):h("",!0)]),_:1}),u(f,{name:"fade"},{default:_(()=>[r.value?(i(),n("div",F,O)):h("",!0)]),_:1})])],64))}};export{K as default};
